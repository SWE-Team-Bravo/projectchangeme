name: Discord PR Notification

on:
  pull_request:
    types: [opened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const action = context.payload.action;
            
            let title, description, color;
            
            if (action === 'opened') {
              title = `PR Opened: ${pr.title}`;
              description = pr.body || "No description";
              color = 3066993;
            } else {
              title = `ðŸŽ‰ ${pr.user.login} merged a PR!`;
              description = pr.title;
              color = 65280;
            }
            
            const contributors = pr.requested_reviewers
              .map(r => r.login)
              .join(', ') || 'No reviewers';
            
            const embed = {
              title: title,
              description: description,
              url: pr.html_url,
              color: color,
              fields: [
                { name: "Author", value: pr.user.login, inline: true },
                { name: "Action", value: action, inline: true },
                { name: "Reviewers", value: contributors, inline: false }
              ]
            };
            
            await fetch(process.env.WEBHOOK_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ embeds: [embed] })
            });
        env:
          WEBHOOK_URL: ${{ secrets.PRS_DISCORD_WEBHOOK }}
